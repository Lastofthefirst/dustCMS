<div class="min-h-screen flex items-center justify-center px-4">
  <div class="card w-full max-w-2xl bg-base-100 shadow-2xl fade-in">
    <div class="card-body">
      <h1 class="card-title text-4xl font-bold mb-2">Welcome to dustCMS</h1>
      <p class="text-base-content/70 mb-8">Let's get your multi-tenant CMS set up in just a few steps</p>

      <div id="setup-form">
        <!-- Step 1: Base Domain -->
        <div id="step-1" class="space-y-6">
          <div class="alert alert-info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span>Step 1 of 2: Configure your base domain</span>
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Base Domain</span>
            </label>
            <input
              type="text"
              id="base-domain"
              placeholder="cms.yourdomain.com"
              class="input input-bordered w-full"
              value="{{BASE_DOMAIN}}"
            />
            <label class="label">
              <span class="label-text-alt">Tenants will be accessible at: tenant-slug.cms.yourdomain.com</span>
            </label>
          </div>

          <button
            class="btn btn-primary w-full"
            onclick="nextStep()"
          >
            Continue
          </button>
        </div>

        <!-- Step 2: Super Admin -->
        <div id="step-2" class="space-y-6 hidden">
          <div class="alert alert-info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span>Step 2 of 2: Create your super-admin account</span>
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Email</span>
            </label>
            <input
              type="email"
              id="admin-email"
              placeholder="admin@yourdomain.com"
              class="input input-bordered w-full"
              required
            />
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Password</span>
            </label>
            <input
              type="password"
              id="admin-password"
              placeholder="Enter a strong password"
              class="input input-bordered w-full"
              required
              minlength="8"
            />
            <label class="label">
              <span class="label-text-alt">Minimum 8 characters</span>
            </label>
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Confirm Password</span>
            </label>
            <input
              type="password"
              id="admin-password-confirm"
              placeholder="Confirm your password"
              class="input input-bordered w-full"
              required
            />
          </div>

          <div id="error-message" class="alert alert-error hidden">
            <span id="error-text"></span>
          </div>

          <div class="flex gap-4">
            <button
              class="btn btn-ghost flex-1"
              onclick="prevStep()"
            >
              Back
            </button>
            <button
              id="submit-btn"
              class="btn btn-primary flex-1"
              onclick="submitSetup()"
            >
              Complete Setup
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let baseDomain = '{{BASE_DOMAIN}}';

  function nextStep() {
    baseDomain = document.getElementById('base-domain').value.trim();
    if (!baseDomain) {
      alert('Please enter a base domain');
      return;
    }
    document.getElementById('step-1').classList.add('hidden');
    document.getElementById('step-2').classList.remove('hidden');
  }

  function prevStep() {
    document.getElementById('step-2').classList.add('hidden');
    document.getElementById('step-1').classList.remove('hidden');
  }

  async function submitSetup() {
    const email = document.getElementById('admin-email').value.trim();
    const password = document.getElementById('admin-password').value;
    const confirmPassword = document.getElementById('admin-password-confirm').value;

    // Validate
    if (!email || !password) {
      showError('Please fill in all fields');
      return;
    }

    if (password.length < 8) {
      showError('Password must be at least 8 characters');
      return;
    }

    if (password !== confirmPassword) {
      showError('Passwords do not match');
      return;
    }

    // Submit
    const btn = document.getElementById('submit-btn');
    btn.classList.add('loading');
    btn.disabled = true;

    try {
      const response = await fetch('/api/setup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ baseDomain, email, password })
      });

      const data = await response.json();

      if (response.ok) {
        // Success! Redirect to login
        window.location.href = '/admin/login';
      } else {
        showError(data.error || 'Setup failed');
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    } catch (error) {
      showError('Network error. Please try again.');
      btn.classList.remove('loading');
      btn.disabled = false;
    }
  }

  function showError(message) {
    const errorDiv = document.getElementById('error-message');
    const errorText = document.getElementById('error-text');
    errorText.textContent = message;
    errorDiv.classList.remove('hidden');
  }
</script>
